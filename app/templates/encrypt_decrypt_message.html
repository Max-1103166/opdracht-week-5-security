{% extends "index.html" %}
{% block body_content %}
<div class="container">
    <!-- versturen -->
    <form id="sendForm" class="send_form">
        <div class="col-12">
            <div class="user_select">
                <label for="users">Kies een user (afzender):</label>
                <select id="users" name="user_id">
                    {% for user in users %}
                    <option value="{{ user.id }}">{{ user.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="user_select">
                <label for="receiver">Kies een ontvanger:</label>
                <select id="receiver" name="receiver_id">
                    {% for user in users %}
                    <option value="{{ user.id }}">{{ user.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="message_input">
            <label for="message">Bericht:</label>
            <input type="text" name="message" placeholder="Type je bericht" id="message" required>
        </div>

        <button type="submit" id="submit_send_button">Verstuur</button>
    </form>

    <div id="response"></div>
</div>

<hr>
<!-- ophalen van bericht -->
<div class="container">
    <form id="retrieveForm" class="send_form">
        <div class="user_select">
            <label for="ophalen">Kies een user om berichten op te halen:</label>
            <select id="ophalen" name="receiver_id">
                {% for user in users %}
                <option value="{{ user.id }}">{{ user.name }}</option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" id="retrieve_button">Ophalen</button>
    </form>

    <div id="retrieved_messages"></div>
</div>

<script>
<!--    javascript voor ophalen van en versturen van bericht-->

document.getElementById('sendForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const responseEl = document.getElementById('response');
  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData.entries());

  try {
    const res = await fetch('/api/send_message', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    const result = await res.json();
    responseEl.textContent = result.message || "Bericht verzonden!";
  } catch (err) {
    responseEl.textContent = "Fout bij verzenden van bericht.";
  }
});
</script>
{% endblock %}